<!doctype html>
<html>
<head></head>
<body>
<div id="calendar"></div>

<script>
  const range = (length) => Array.from({ length }, (_, i) => i);
  const chunk = (arr, size) => {
    if (size === 0) return arr;
    return Array.from({length: Math.ceil(arr.length / size)}, (v, i) =>
      arr.slice(i * size, i * size + size)
    );
  };

  const LEAP_YEAR = 2000;
  const LEAP_YEAR_PERIOD = 4;
  const MONTH_FEBRUARY = 2;
  const LAST_DAYS = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
  const LEAP_YEAR_LAST_DATE = 29;
  const WEEK_LENGTH = 7;

  const setDate = (date, day) => {
    const clonedDate = new Date(date);
    clonedDate.setDate(day);
    return clonedDate
  };
  const addMonth = (date, count) => {
    const clonedDate = new Date(date);
    clonedDate.setMonth(clonedDate.getMonth() + count);
    return clonedDate
  };
  const subtractMonth = (date, count) => {
    return addMonth(date, -count)
  };

  const isLeapMonth = (year, month) => {
    const diffYear = Math.abs(year - LEAP_YEAR);
    return diffYear % LEAP_YEAR_PERIOD === 0 && month === MONTH_FEBRUARY
  };
  const toLastDay = (date) => {
    const year = date.getFullYear();
    const month = date.getMonth();
    return isLeapMonth(year, month + 1)
      ? LEAP_YEAR_LAST_DATE
      : LAST_DAYS[month]
  };

  const toMonthDays = (date) => {
    const firstDate = setDate(date, 1);
    const firstDateIndex = firstDate.getDay();
    const lastDate = toLastDay(date);
    const restDay = (firstDateIndex + lastDate) % WEEK_LENGTH;
    const nextMonthLength = restDay ? WEEK_LENGTH - restDay : restDay;

    const prevMonthDays = range(firstDateIndex).map(() => '');
    const currentMonthDays = range(lastDate).map((_, i) => setDate(date, i + 1)); // [1, 2, ...]
    const nextMonthDays = range(nextMonthLength).map(() => '');

    return chunk(
      [
        ...prevMonthDays,
        ...currentMonthDays,
        ...nextMonthDays
      ],
      WEEK_LENGTH
    )
  };

  const state = {
    current: new Date('2020-04-20T00:00:00'),
    get monthDays() {
      return toMonthDays(state.current)
    },
    get title() {
      const year = state.current.getFullYear();
      const month = state.current.getMonth() + 1;
      return `${year}.${month}`
    }
  };

  const mutation = {
    mutateCurrent: (current) => {
      state.current = current;
    }
  };

  const actions = {
    fetchNextMonth: () => {
      const nextMonth = addMonth(state.current, 1);
      mutation.mutateCurrent(nextMonth)
    },
    fetchPrevMonth: () => {
      const prevMonth = subtractMonth(state.current, 1);
      mutation.mutateCurrent(prevMonth)
    }
  }
</script>
<script>
  const onClickPrev = () => {
    actions.fetchPrevMonth();
    render();
  };
  const onClickNext = () => {
    actions.fetchNextMonth();
    render();
  };

  const buttonTemplate = () => {
    return `<div>
      <button onclick="onClickPrev()" type="button">Prev</button>
      <button onclick="onClickNext()" type="button">Next</button>
    </div>`
  };
  const calendarTemplate = () => {
    const weeks = state.monthDays
      .map((week) => {
        const days = week
          .map((day) => {
            return `<td>${day ? day.getDate() : ''}</td>`
          })
          .join('');
        return `<tr>${days}</tr>`
      })
      .join('');
    return `<table>${weeks}</table>`
  };
  const render = () => {
    const template = `
      ${buttonTemplate()}
      <div>${state.title}</div>
      ${calendarTemplate()}
    `;
    document.querySelector('#calendar').innerHTML = template
  };

  render();
</script>
</body>
</html>
